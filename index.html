<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ownly - Coming Soon</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <main class="container">
        <header class="hero">
            <h1 class="logo">Ownly</h1>
            <p class="tagline">Coming Soon</p>
            <p class="description">Something exciting is on the way. Be the first to know when we launch.</p>
        </header>

        <form id="waitlist-form" class="waitlist-form">
            <div class="input-group">
                <input
                    type="email"
                    id="email"
                    name="email"
                    placeholder="Enter your email"
                    required
                    autocomplete="email"
                >
                <button type="submit" id="submit-btn">Join Waitlist</button>
            </div>
            <div id="message" class="message" aria-live="polite"></div>
        </form>

        <footer class="footer">
            <p>&copy; 2026 Ownly. All rights reserved. <span style="opacity:0.5">v1.13</span></p>
        </footer>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    var supabase = window.supabase.createClient(
        'https://ldabzqoxgogwxixicpml.supabase.co',
        'sb_publishable_262uXsz-j2gr1HZA_1ukSA_m2Z1_Q39'
    );

    document.getElementById('waitlist-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        var email = document.getElementById('email').value.trim().toLowerCase();
        var btn = document.getElementById('submit-btn');
        var msg = document.getElementById('message');

        if (!email) { msg.textContent = 'Please enter your email'; msg.className = 'message error show'; return; }

        // Validate email format
        var emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if (!emailRegex.test(email)) {
            // Find invalid characters
            var validChars = /[a-zA-Z0-9._%+-@-]/g;
            var invalidChars = email.replace(validChars, '').split('').filter(function(v, i, a) { return a.indexOf(v) === i; });
            if (invalidChars.length > 0) {
                msg.textContent = 'Invalid character(s): ' + invalidChars.join(', ');
            } else {
                msg.textContent = 'Please enter a valid email address';
            }
            msg.className = 'message error show';
            return;
        }

        btn.disabled = true;
        btn.textContent = 'Joining...';

        try {
            var result = await supabase.from('waitlist').insert([{ email: email }]);
            if (result.error) {
                // Handle duplicate email error
                if (result.error.code === '23505' || result.error.message.includes('duplicate key')) {
                    msg.textContent = 'This email is already on the waitlist!';
                } else {
                    msg.textContent = 'Something went wrong. Please try again.';
                }
                msg.className = 'message error show';
            } else {
                window.location.href = 'thanks.html';
            }
        } catch(err) {
            msg.textContent = 'Something went wrong. Please try again.';
            msg.className = 'message error show';
        }
        btn.disabled = false;
        btn.textContent = 'Join Waitlist';
    });
    </script>
</body>
</html>
